# Fleet Management Simple Metrics Server

Small Go HTTP service that exposes **simple uptime and upload-time metrics** for a fleet of devices.

It is designed to work with the SafelyYou device simulator binary and to demonstrate:

- Clean, layered / hexagonal-ish architecture (core vs adapters)
- Proper input validation
- Swagger / OpenAPI documentation
-  Unit-test coverage at service, repository, and HTTP levels

---

## Prerequisites
- Go 1.21+
- device-simulator => according the operating system
- swagger CLI ( instlled during make install command)
- update `.env.default` to `.env`

## Documenation 
the documentation is accessible here : 
`http://localhost:8080/docs/index.html#/`
## Makefile commands

```makefile
make install #install swagger and run go mod tidy
make run #start the project
make test #run the tests
make doc  #generate the doc 
```

## Features

- Reads a `devices.csv` file on startup and pre-loads all devices
- Accepts **heartbeats** and **upload stats** per device
- Computes:
    - Uptime percentage
    - Average upload time (as a duration string)
- Exposes JSON API:
    - `POST /api/v1/devices/{device_id}/heartbeat`
    - `POST /api/v1/devices/{device_id}/stats`
    - `GET  /api/v1/devices/{device_id}/stats`
- Swagger UI documentation at `/docs/index.html`
- Unit tests for:
    - Core business logic 
    - In-memory repository behavior
    - HTTP handlers (validation + error mapping)

---

## Project Layout

```text
safelyyou/
├── cmd/
│   └── app/
│       └── main.go                 # App entrypoint (wiring, config)
├── internal/
│   ├── core/
│   │   ├── domain/
│   │   │   └── device.go           # DeviceStats entity & helpers
│   │   ├── ports/
│   │   │   └── device_port.go      # DeviceService, DeviceRepository, Stats
│   │   ├── services/
│   │   │   └── device_service.go   # DeviceServiceImpl (business logic)
│   │   └── errors/
│   │       └── errors.go           # e.g. ErrDeviceNotFound
│   └── adapters/
│       ├── repository/
│       │   └── memory/
│       │       └── device_repository.go # In-memory repository (mutex + map)
│       └── http/
│           ├── dto.go              # HTTP request/response DTOs
│           ├── handlers.go         # Gin handlers
│           └── routes.go           # Route registration + Swagger UI wiring
├── docs/
│   ├── docs.go                     # generated by swag
│   ├── swagger.json                # generated
│   └── swagger.yaml                # generated
├── devices.csv                     # Initial device IDs
├── Makefile                        # common commands
├── device-simulator-mac-arm64                       
├── go.mod
└── README.md
